---
title: "TSA Competition"
output: pdf_document
date: "2024-03-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading packages

```{r}

library(lubridate)
library(ggplot2)
library(forecast)
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(cowplot)
library(sarima)
library(readxl)


```

```{r}
#Importing data and wrangling

#Importing data
data <- read_excel("./Data/load.xlsx")

df_load_data<-data[,3:26]
df_load_processed<-df_load_data %>%
  mutate(daily_mean=rowMeans(df_load_data, na.rm = TRUE))

data_final <- cbind(data[,2],df_load_processed[,25])


```

```{r}

#Showing initial plot
ggplot(data_final,aes(x = date, y = daily_mean)) + 
  geom_line()

```


```{r}
#Converting to time series
mts_data <- msts(data_final[,2],seasonal.periods =  c(7,365), start = c(2005, 01, 01), end=c(2011,05,31))
head(mts_data)
ACFplot <- acf(mts_data)
PACFplot <- pacf(mts_data)
```
```{r message=FALSE, warning=FALSE}
#Decomposing the time series
## ts_act_power_daily %>% mstl() = mstl(ts_act_power_daily)
mts_data %>% mstl() %>%
  autoplot()
```



```{r}
#testing set 
mts_data_forecast <- msts(data_final[,2],seasonal.periods =  c(7,365), start = c(2011, 06, 01), end=c(2011,06,31))
head(mts_data_forecast)
```
```{r message=FALSE, warning=FALSE}
#create a subset for training purpose
n_for = 31
ts_train <- subset(mts_data,
                            end = length(mts_data)-n_for)

#create a subset for testing purpose
ts_test <- subset(mts_data,
                          start = length(mts_data)-n_for)

autoplot(ts_train)
autoplot(ts_test)
```

```{r ARIMA, echo=TRUE, message=FALSE, warning=FALSE}

ARIMA_Four_fit <- auto.arima(ts_train, 
                             seasonal=FALSE, 
                             lambda=0,
                             xreg=fourier(ts_train, 
                                          K=c(2,12))
                             )


#Forecast with ARIMA fit

ARIMA_Four_for <- forecast(ARIMA_Four_fit,
                           xreg=fourier(ts_train,
                                        K=c(2,12),
                                        h=31),
                           h=31
                           )


autoplot(ARIMA_Four_for) + ylab("Active Power")
```


```{r}
#head(ARIMA_Four_for)
Final_Forecast_June<- data.frame(ARIMA_Four_for)
Final_Forecast_June
write.csv(Final_Forecast_June, file="./Data/Final_Forecast_June.csv")
```


